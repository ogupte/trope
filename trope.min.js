(function(m,p){var l,n;"undefined"!==typeof module&&module.exports?(l=module,n=module.exports):(l={exports:{}},n=l.exports);if(n=p(l,n))l.exports=n;"undefined"!==typeof window&&(window[m]=l.exports);return n})("Trope",function(m,p){function l(h,e){if(h===e)return e;var f=Object.keys(h),g,k;for(g=0;g<f.length;g+=1)k=f[g],e[k]=h[k];return e}function n(h,e){var f=Object.getPrototypeOf(h);h&&f&&(e(f),n(f,e))}function z(h,e){var f=[h],g;n(h,function(e){f.push(e)});for(g=f.length-1;0<=g;g--)e(f[g])}function v(h,
e){Object.keys(h).forEach(function(f){"function"===typeof h[f]&&e(h[f],f)})}function q(h,e,f){return Object.defineProperty(h,e,{value:f,configurable:!0,enumerable:!1,writable:!0})}function r(h,e,f){var g;for(g=0;g<e.length;g++)h[e[g]]=f}function w(h){var e=h.length,f,g;for(f=0;f<e;f++)g=h[f],h.push(g.charAt(0).toUpperCase()+g.substr(1));return h}(function(){function h(){return m.exports.defaultDefinition.apply(m.exports,arguments)}function e(a,b){m.exports[a]=b}function f(a){a.stack=[];return a}function g(a,
b,c,d,e){b instanceof k||"function"===typeof b&&(b=b.trope?b.trope:new k({constructor:b,prototype:b.prototype,useSuper:!1}));a.trope=b;a.pubCtx=c||Object.create(a.trope.finalProto);a.privateCtx=d||Object.create(a.pubCtx);a.privateCtx.exports||(a.privateCtx.exports=a.pubCtx);a.targetCtx=a.getTargetContext();a.executionStack=e||f.create();return a}function k(a){if("function"===typeof a){if(a.trope&&a.trope instanceof k)return a.trope;a={constructor:a}}a=a||{prototype:Object.create(null),useSuper:!1};
var b=this;b.def=a;b.proto=a.prototype?a.prototype:a["public"]?a["public"]:null===a.prototype?Object.create(null):Object.hasOwnProperty.call(a.constructor,"prototype")?a.constructor.prototype:Object.create(null);b.constr=a.hasOwnProperty("constructor")?a.constructor.trope?a.constructor.trope.constr:a.constructor:a.init?a.init:b.proto.hasOwnProperty&&b.proto.hasOwnProperty("constructor")?b.proto.constructor:b.proto instanceof Object?A:B;b.inherits=a.inherits?a.inherits instanceof k?a.inherits:a.inherits.trope?
a.inherits.trope:"function"===typeof a.inherits?new k({constructor:a.inherits,prototype:a.inherits.prototype,useSuper:!1}):new k({prototype:a.inherits,useSuper:!1}):null;b.typeName=function(){var d;if(a.type)return a.type;if(b.constr!==Object&&b.constr.name)return b.constr.name;d=b.constr.toString();return(d=d.substr(0,d.indexOf("(")).replace("function","").trim())?d:b.inherits?b.inherits.typeName+"\u2093":"Object\u2093"}();b.instanceName=a.instance||b.typeName+"\u1d62";if(void 0===a.useInstanceName||
a.useInstanceName)b.instanceContructor=eval("(function "+b.instanceName+" () {})"),b.instanceContructor.trope=b;var c;b.inherits&&b.inherits.useSuper?(void 0===a.useSuper||a.useSuper||console.warn("useSuper {"+b.typeName+"} must be same as parent {"+b.inherits.typeName+"} (defaults to true)!"),c=b.inherits.useSuper):c=void 0!==a.useSuper?a.useSuper:!0;b.useSuper=c;b.isSelfish=!!a.selfish;b.isPrivate=a["private"]?!0:void 0!==a.privacy?a.privacy:b.inherits?b.inherits.isPrivate:!1;b.methodMap=function(){var a=
{};b.forEachTropeInChain(function(b){b.forEachMethod(function(c,e){a[e]={trope:b,func:c}})});return a}();b.privateMethodMap=function(){var a=null;b.inherits&&b.inherits.privateMethodMap&&(a={},Object.keys(b.inherits.privateMethodMap).forEach(function(c){a[c]=b.inherits.privateMethodMap[c]}));b.def["private"]&&null===a&&(a={});b.def["private"]&&v(b.def["private"],function(c,e){a[e]={name:e,func:c,trope:b}});return a}();b.autoInitializeConfigs=[];b.forEachTropeInChain(function(a){var c=a.def.autoinit;
c&&a!==b&&(Array.isArray(c)?b.autoInitializeConfigs.push({mode:1296124225,trope:a,args:c}):"function"===typeof c?b.autoInitializeConfigs.push({mode:1296124233,trope:a,initFunc:c}):b.autoInitializeConfigs.push({mode:1296124227,trope:a}))});b.finalProto=b.getPrototype();b.constr!==Object&&q(b.finalProto,"constructor",b.constr)}function t(a){return(new k(a)).getConstructor()}function p(){var a=arguments,b,c=[],d={};for(b=0;b<a.length;b++)c.push(a[b]);a=c.pop();for(b=!1;a;)"function"===typeof a&&(a.trope?
d=a.trope.getDefinition(d):d.constructor=a),"object"===typeof a?b||a.__TROPEDEF__?d=l(d,a):(d.prototype=a,b=!0):"string"===typeof a&&(d.type=a),a=c.pop();return d}function u(){var a;a=arguments;if(1===a.length&&"function"===typeof a[0]&&a[0].trope)return a[0];a=p.apply(null,a);return t(a)}m.exports=function(){return m.exports.defaultAction.apply(m.exports,arguments)};e("set",e);var A=function(){},B=function(){},x=w(["class","extend","define"]),y=w(["proto","turn","link","chain"]);f.prototype={push:function(a,
b,c){this.stack.push({executionContext:a,type:b,data:c})},pop:function(){return this.stack.pop()},peek:function(){return this.stack[this.stack.length-1]}};f.create=function(){return f(Object.create(f.prototype))};g.create=function(a,b,c,d){return g(Object.create(g.prototype),a,b,c,d)};g.prototype={as:function(a){return g.create(a,this.pubCtx,this.privateCtx,this.executionStack)},hasSuper:function(){return this.trope.superConstr?!0:!1},overrideMethod:function(a,b,c){var d=this,e;d.pubCtx.hasOwnProperty&&
d.pubCtx.hasOwnProperty(a)&&(e=d.pubCtx[a]);d.pubCtx[a]=function(){var f=arguments,g=d;c&&(g=d.as(c));d.executionStack.push(g,12800,{name:a,superMethod:e});f=b.apply(g.getTargetContext(),f);d.executionStack.pop();return f}},getPublicContext:function(){return this.pubCtx},getPrivateContext:function(){return this.privateCtx},getTargetContext:function(){return this.trope.isPrivate?this.privateCtx:this.pubCtx},callWithContext:function(a,b,c,d){this.executionStack.push(this,a,d);a=b(c);this.executionStack.pop();
return a},getAsMemberFunction:function(a,b,c,d){var e=this,f=e.targetCtx,g=13056;!1===c?f=e.pubCtx:!0===c&&(f=e.privateCtx,d&&(g=13312));return function(){var c=arguments,d,h=b;e.callWithContext(g,function(a){e.trope.isSelfish&&(h=b.bind(a,f));d=h.apply(a,c)},f,{name:a});return d}},getAsPublicMethod:function(a,b){return this.getAsMemberFunction(a,b,!1,!0)},getAsPrivateMethod:function(a,b){return this.getAsMemberFunction(a,b,!0,!0)},getMethod:function(a){var b=this.trope.methodMap[a];return this.as(b.trope).getAsMemberFunction(a,
b.func)},getPrivateMethod:function(a){var b=this.trope.privateMethodMap[a];return this.as(b.trope).getAsPrivateMethod(a,b.func)},callAsConstructor:function(a){return this.callWithContext(12288,a,this.targetCtx)},getParentContextualFunction:function(){if(this.trope.inherits)return this.as(this.trope.inherits).getContextualFunction()},getSuperFunction:function(){return this.executionStack.peek().executionContext.getParentContextualFunction()},getContextualFunction:function(){var a=this.executionStack.peek(),
b;if(a){b=a.type;a=a.data;if(12288===b)return this.getConstructor();if(12800===b)return a.superMethod;if(13056===b)return this.getMethod(a.name);if(13312===b)return this.getPrivateMethod(a.name)}},getConstructor:function(){var a=this;return function(){var b=arguments;a.callAsConstructor(function(c){a.trope.isSelfish?a.trope.constr.bind(c,a.getTargetContext()).apply(c,b):a.trope.constr.apply(c,b)})}}};k.prototype={getConstructor:function(){var a=this;return function(b){b.trope=a;b.create=function(){return b.apply(null,
arguments)};r(b,y,a.interpretChild.bind(a));r(b,x,a.defineChild.bind(a));return b}(a.buildProxyConstructor())},buildProxyConstructor:function(){var a=this;return function(b){b.prototype=a.finalProto;return b}(function(){var b=arguments,c=g.create(a),d=c.getPublicContext(),e=c.getPrivateContext();a.useSuper&&d.hasOwnProperty&&!d.hasOwnProperty("super")&&Object.defineProperty(d,"super",{enumerable:!1,get:function(){var b;a.inherits&&(b=c.getSuperFunction());b&&(b.as=function(a){return c.as(a).getContextualFunction()});
return b}});Object.keys(a.methodMap).forEach(function(b){var e=a.methodMap[b];q(d,b,c.as(e.trope).getAsMemberFunction(b,e.func))});a.privateMethodMap&&Object.keys(a.privateMethodMap).forEach(function(b){var d=a.privateMethodMap[b];q(e,b,c.as(d.trope).getAsPrivateMethod(b,d.func))});a.instanceContructor&&q(d,"constructor",a.instanceContructor);a.autoInitializeConfigs.forEach(function(a){var d=a.trope;1296124227===a.mode?c.as(d).getConstructor().apply(null,b):1296124225===a.mode?c.as(d).getConstructor().apply(null,
a.args):1296124233===a.mode&&c.as(d).callAsConstructor(function(c){a.initFunc.apply(c,b)})});c.getConstructor().apply(c.getTargetContext(),b);return d})},getPrototype:function(){return this.inherits?l(this.proto,Object.create(this.inherits.finalProto)):this.proto},getSuperConstructor:function(){return this.useSuper&&this.inherits?this.inherits.getConstructor(!0):null},forEachTropeInChain:function(a){this.inherits&&this.inherits.forEachTropeInChain(a);a(this)},forEachMethod:function(a){z(this.proto,
function(b){v(b,a)})},createChildTrope:function(a){a=a||{};if(a.inherits){var b=this;(function(a){return a?a instanceof k?a:a.trope?a.trope:"function"===typeof a?new k({constructor:a,prototype:a.prototype,useSuper:!1}):new k({prototype:a,useSuper:!1}):null})(a.inherits).forEachTropeInChain(function(a){b=new k(a.getDefinition({inherits:b}))});a.inherits=b}else a.inherits=this;return new k(a)},defineChild:function(a){return this.createChildTrope(a).getConstructor()},interpretChild:function(){var a=
h.apply(null,arguments);return this.defineChild(a)},getDefinition:function(a){return a?l(a,l(this.def,{})):l(this.def,{})},isInstance:function(a){var b=this,c=!1;n(a,function(a){a.constructor===b.constr&&(c=!0)});return c}};e("Trope",k);e("define",t);e("instanceOf",function(a,b){if(2!==arguments.length)throw Error("Trope.instanceOf only supports 2 arguments");var c,d;if("function"===typeof a&&"object"===typeof b)c=a,d=b;else if("object"===typeof a&&"function"===typeof b)d=a,c=b;else throw Error("Trope.instanceOf must have an OBJECT and FUNCTION as arguments");
return c.trope?c.trope.isInstance(d):d instanceof c});e("defaultDefinition",p);e("interpret",u);e("defaultAction",u);r(m.exports,y,u);r(m.exports,x,t)})()});
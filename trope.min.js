function mix(c,f){if(c===f)return f;var b=Object.keys(c),e,m;for(e=0;e<b.length;e+=1)m=b[e],f[m]=c[m];return f}function forEachPrototypeOf(c,f){var b=Object.getPrototypeOf(c);c&&b&&(f(b),forEachPrototypeOf(b,f))}function forEachProtoInChain(c,f){var b=[c],e;forEachPrototypeOf(c,function(c){b.push(c)});for(e=b.length-1;0<=e;e--)f(b[e])}function forEachMethod(c,f){Object.keys(c).forEach(function(b){"function"===typeof c[b]&&f(c[b],b)})}
function setNonEnumerableProperty(c,f,b){return Object.defineProperty(c,f,{value:b,configurable:!0,enumerable:!1,writable:!0})}function applyAliases(c,f,b){var e;for(e=0;e<f.length;e++)c[f[e]]=b}
var Trope=function(){function c(a){if(typeof a===e){if(a.trope&&a.trope instanceof c)return a.trope;a={constructor:a}}this.def=a=a||{prototype:Object.create(null),useSuper:!1};this.proto=a.prototype?a.prototype:null===a.prototype?Object.create(null):Object.hasOwnProperty.call(a.constructor,m)?a.constructor.prototype:Object.create(null);this.constr=a.hasOwnProperty(p)?a.constructor:this.proto.hasOwnProperty&&this.proto.hasOwnProperty(p)?this.proto.constructor:this.proto instanceof Object?r:s;this.inherits=
a.inherits?a.inherits instanceof c?a.inherits:a.inherits.trope?a.inherits.trope:typeof a.inherits===e?new c({constructor:a.inherits,prototype:a.inherits.prototype,useSuper:!1}):new c({prototype:a.inherits,useSuper:!1}):null;this.typeName=a.type?a.type:this.constr!==Object&&this.constr.name?this.constr.name:this.inherits?this.inherits.typeName+"\u2093":"Object\u2093";this.instanceName=a.instance||this.typeName+"\u1d62";if(void 0===a.useInstanceName||a.useInstanceName)this.instanceContructor=eval("(function "+
this.instanceName+" () {})"),this.instanceContructor.trope=this;var d;this.inherits&&this.inherits.useSuper?(void 0===a.useSuper||a.useSuper||console.warn("useSuper {"+this.typeName+"} must be same as parent {"+this.inherits.typeName+"} (defaults to true)!"),d=this.inherits.useSuper):d=void 0!==a.useSuper?a.useSuper:!0;this.useSuper=d;this.isPrivate=void 0!==a.privacy?a.privacy:this.inherits?this.inherits.isPrivate:!1;this.superConstr=this.getSuperConstructor();this.finalProto=this.getPrototype();
this.constr!==Object&&setNonEnumerableProperty(this.finalProto,p,this.constr)}function f(a){return(new c(a)).getConstructor()}function b(){var a=arguments,a=(k[a.length]||k["?"]).apply(k,a);return f(a)}var e="function",m="prototype",p="constructor",r=function(){},s=function(){},n=function(a){var d=a.length,h,c;for(h=0;h<d;h++)c=a[h],a.push(c.charAt(0).toUpperCase()+c.substr(1));return a}("class proto alter alt turn extend ext modify mod link chain draft denote outline cast exhibit model compound enhance".split(" "));
c.prototype={getConstructor:function(a){var d=this;return function(a){a.prototype=d.finalProto;a.trope=d;a.create=function(){var d=Object.create(a.prototype);a.apply(d,arguments);return d};applyAliases(a,n,d.extend.bind(d));return a}(d.createProxyConstructor(a))},createProxyConstructor:function(a){var d=this;return function(){function h(){if(a)return f[1];k||(k=Object.create(g),k.exports=g);return k}var b=arguments,f=arguments,g=this,k,m=g;d.isPrivate&&(m=h());var l;d.useSuper&&!a&&g.hasOwnProperty&&
!g.hasOwnProperty("super")&&Object.defineProperty(g,"super",{enumerable:!1,get:function(){var a=l.peek(),d=g;if(a&&a.func){a.trope&&a.trope.isPrivate&&(d=h());if(a.isConstructor){var b=function(){var c=arguments,b,e=[l,h()];for(b=0;b<c.length;b++)e.push(c[b]);a.func.apply(d,e)};b.as=function(a){a instanceof c||typeof a===e&&(a=a.trope?a.trope:new c({constructor:a,prototype:a.prototype,useSuper:!1}));var d=a.createProxyConstructor(!0);return function(){var a,b=[l,h()];for(a=0;a<arguments.length;a++)b.push(arguments[a]);
d.apply(g,b)}};return b}var b=function(){var h;a.trope.inherits?l.push({func:a.trope.inherits.finalProto[a.methodName],trope:a.trope.inherits,isMethod:!0,methodName:a.methodName}):l.push({func:null,trope:null,isMethod:!0,methodName:a.methodName});h=a.func.apply(d,arguments);l.pop();return h},f=a.methodName;b.as=function(a){a instanceof c||typeof a!==e||!a.trope||(a=a.trope);d=a.isPrivate?h():g;return function(){var h;a.inherits?l.push({func:a.inherits.finalProto[f],trope:a.inherits,isMethod:!0,methodName:f}):
l.push({func:null,trope:null,isMethod:!0,methodName:f});h=a.finalProto[f].apply(d,arguments);l.pop();return h}};return b}}});if(a){var q;l=b[0];var n=[];for(q=2;q<b.length;q++)n.push(b[q]);b=n}else l={stack:[],peek:function(){return this.stack[this.stack.length-1]},push:function(a){return this.stack.push(a)},pop:function(){return this.stack.pop()}},d.forEachTropeInChain(function(a){a.forEachMethod(function(d,b){var c;g.hasOwnProperty&&g.hasOwnProperty(b)&&(c=g[b]);g[b]=function(){var e=arguments;
l.push({func:c,trope:a,isMethod:!0,methodName:b});e=a.isPrivate?d.apply(h(),e):d.apply(g,e);l.pop();return e}})});!a&&d.instanceContructor&&setNonEnumerableProperty(g,p,d.instanceContructor);l.push({func:d.superConstr,trope:d.inherits,isConstructor:!0});d.constr.apply(m,b);l.pop()}},getPrototype:function(){return this.inherits?mix(this.proto,Object.create(this.inherits.finalProto)):this.proto},getSuperConstructor:function(){return this.useSuper&&this.inherits?this.inherits.getConstructor(!0):null},
forEachTropeInChain:function(a){this.inherits&&this.inherits.forEachTropeInChain(a);a(this)},forEachMethod:function(a){forEachProtoInChain(this.proto,function(d){forEachMethod(d,a)})},createChildTrope:function(a){a=a||{};if(a.inherits){var d=this;(function(a){return a?a instanceof c?a:a.trope?a.trope:typeof a===e?new c({constructor:a,prototype:a.prototype,useSuper:!1}):new c({prototype:a,useSuper:!1}):null})(a.inherits).forEachTropeInChain(function(a){d=new c(a.getDefinition({inherits:d}))});a.inherits=
d}else a.inherits=this;return new c(a)},defineChild:function(a){return this.createChildTrope(a).getConstructor()},extend:function(){var a=arguments,a=(k[a.length]||k["?"]).apply(k,a);return this.defineChild(a)},getDefinition:function(a){return a?mix(a,mix(this.def,{})):mix(this.def,{})},isInstance:function(a){var d=this,b=!1;forEachPrototypeOf(a,function(a){a.constructor===d.constr&&(b=!0)});return b}};b.Trope=c;b.define=f;var k={0:function(){},1:function(a){var d=typeof a,b;"object"===d?b=null!==
a&&a.__TROPEDEF__?a:{prototype:a}:d===e?b=a.trope?a.trope.getDefinition():{constructor:a}:"string"===d&&(b={type:a});return b},2:function(a,d){var b=typeof a,c=typeof d,b="object"===b&&null!==a?a:b===e?a.trope?a.trope.getDefinition():{constructor:a}:"string"===b?{type:a}:{};"object"===c?b.prototype=d:c===e?d.trope?b=mix(b,d.trope.getDefinition()):b.constructor=d:"string"===c&&(b.type=d);return b},3:function(a,b,c){var f=typeof a,k=typeof b,g=typeof c;a="object"===f&&null!==a?a:f===e?a.trope?a.trope.getDefinition():
{constructor:a}:"string"===f?{type:a}:{};"object"===k?a.prototype=b:k===e?b.trope?a=mix(a,b.trope.getDefinition()):a.constructor=b:"string"===k&&(a.type=b);"object"===g?a.prototype=c:g===e?c.trope?a=mix(a,c.trope.getDefinition()):a.constructor=c:"string"===g&&(a.type=c);return a},"?":function(){return this["3"].apply(this,arguments)}};b.Define=b;b.instanceOf=function(a,b){if(2!==arguments.length)throw Error("Trope.instanceOf only supports 2 arguments");var c,f;if(typeof a===e&&"object"===typeof b)c=
a,f=b;else if("object"===typeof a&&typeof b===e)f=a,c=b;else throw Error("Trope.instanceOf must have an OBJECT and FUNCTION as arguments");return c.trope?c.trope.isInstance(f):f instanceof c};applyAliases(b,n,b);return b}();module.exports=Trope;

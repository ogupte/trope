(function(r,m,s){var d,p,t=!1;"undefined"!==typeof window?(t=!0,d={exports:{}},p=d.exports):"undefined"!==typeof module&&module.exports&&(d=module,p=module.exports);if(m=m(d,p,s))d.exports=m;t&&(window[r]=d.exports);return m})("Trope",function(r,m,s){function d(g,f){if(g===f)return f;var e=Object.keys(g),k,d;for(k=0;k<e.length;k+=1)d=e[k],f[d]=g[d];return f}function p(g,f){var e=Object.getPrototypeOf(g);g&&e&&(f(e),p(e,f))}function t(g,f){var e=[g],d;p(g,function(d){e.push(d)});for(d=e.length-1;0<=
d;d--)f(e[d])}function w(d,f){Object.keys(d).forEach(function(e){"function"===typeof d[e]&&f(d[e],e)})}function u(d,f,e){return Object.defineProperty(d,f,{value:e,configurable:!0,enumerable:!1,writable:!0})}function y(d,f,e){var k;for(k=0;k<f.length;k++)d[f[k]]=e}m=function(){function g(a){a.stack=[];return a}function f(a,b,c,h,d){b instanceof e||typeof b===l&&(b=b.trope?b.trope:new e({constructor:b,prototype:b.prototype,useSuper:!1}));a.trope=b;a.pubCtx=c||Object.create(a.trope.finalProto);a.privateCtx=
h||Object.create(a.pubCtx);a.privateCtx.exports||(a.privateCtx.exports=a.pubCtx);a.targetCtx=a.getTargetContext();a.executionStack=d||g.create();return a}function e(a){if(typeof a===l){if(a.trope&&a.trope instanceof e)return a.trope;a={constructor:a}}a=a||{prototype:Object.create(null),useSuper:!1};var b=this;b.def=a;b.proto=a.prototype?a.prototype:null===a.prototype?Object.create(null):Object.hasOwnProperty.call(a.constructor,m)?a.constructor.prototype:Object.create(null);b.constr=a.hasOwnProperty(v)?
a.constructor.trope?a.constructor.trope.constr:a.constructor:b.proto.hasOwnProperty&&b.proto.hasOwnProperty(v)?b.proto.constructor:b.proto instanceof Object?r:s;b.inherits=a.inherits?a.inherits instanceof e?a.inherits:a.inherits.trope?a.inherits.trope:typeof a.inherits===l?new e({constructor:a.inherits,prototype:a.inherits.prototype,useSuper:!1}):new e({prototype:a.inherits,useSuper:!1}):null;b.typeName=function(){var c;if(a.type)return a.type;if(b.constr!==Object&&b.constr.name)return b.constr.name;
c=b.constr.toString();return(c=c.substr(0,c.indexOf("(")).replace("function","").trim())?c:b.inherits?b.inherits.typeName+"\u2093":"Object\u2093"}();b.instanceName=a.instance||b.typeName+"\u1d62";if(void 0===a.useInstanceName||a.useInstanceName)b.instanceContructor=eval("(function "+b.instanceName+" () {})"),b.instanceContructor.trope=b;var c;b.inherits&&b.inherits.useSuper?(void 0===a.useSuper||a.useSuper||console.warn("useSuper {"+b.typeName+"} must be same as parent {"+b.inherits.typeName+"} (defaults to true)!"),
c=b.inherits.useSuper):c=void 0!==a.useSuper?a.useSuper:!0;b.useSuper=c;b.isPrivate=a["private"]?!0:void 0!==a.privacy?a.privacy:b.inherits?b.inherits.isPrivate:!1;b.methodMap=function(){var a={};b.forEachTropeInChain(function(b){b.forEachMethod(function(c,d){a[d]={trope:b,func:c}})});return a}();b.privateMethodMap=function(){var a=null;b.inherits&&b.inherits.privateMethodMap&&(a={},w(b.inherits.privateMethodMap,function(b,c){a[c]=b}));b.def["private"]&&null===a&&(a={});b.def["private"]&&w(b.def["private"],
function(c,d){a[d]={name:d,func:c,trope:b}});return a}();b.autoInitializeConfigs=[];b.forEachTropeInChain(function(a){var c=a.def.autoinit;c&&a!==b&&(Array.isArray(c)?b.autoInitializeConfigs.push({mode:z,trope:a,args:c}):typeof c===l?b.autoInitializeConfigs.push({mode:A,trope:a,initFunc:c}):b.autoInitializeConfigs.push({mode:B,trope:a}))});b.finalProto=b.getPrototype();b.constr!==Object&&u(b.finalProto,v,b.constr)}function k(a){return(new e(a)).getConstructor()}function n(){var a=arguments,a=(q[a.length]||
q["?"]).apply(q,a);return k(a)}var l="function",m="prototype",v="constructor",r=function(){},s=function(){},B=1296124227,A=1296124233,z=1296124225,C=function(a){var b=a.length,c,h;for(c=0;c<b;c++)h=a[c],a.push(h.charAt(0).toUpperCase()+h.substr(1));return a}("class proto alter alt turn extend ext modify mod link chain draft denote outline cast exhibit model compound enhance".split(" "));g.prototype={push:function(a,b,c){this.stack.push({executionContext:a,type:b,data:c})},pop:function(){return this.stack.pop()},
peek:function(){return this.stack[this.stack.length-1]}};g.create=function(){return g(Object.create(g.prototype))};f.create=function(a,b,c,h){return f(Object.create(f.prototype),a,b,c,h)};f.prototype={as:function(a){return f.create(a,this.pubCtx,this.privateCtx,this.executionStack)},hasSuper:function(){return this.trope.superConstr?!0:!1},overrideMethod:function(a,b,c){var h=this,d;h.pubCtx.hasOwnProperty&&h.pubCtx.hasOwnProperty(a)&&(d=h.pubCtx[a]);h.pubCtx[a]=function(){var e=arguments,f=h;c&&(f=
h.as(c));h.executionStack.push(f,12800,{name:a,superMethod:d});e=b.apply(f.getTargetContext(),e);h.executionStack.pop();return e}},getPublicContext:function(){return this.pubCtx},getPrivateContext:function(){return this.privateCtx},getTargetContext:function(){return this.trope.isPrivate?this.privateCtx:this.pubCtx},callWithContext:function(a,b,c,d){this.executionStack.push(this,a,d);a=b(c);this.executionStack.pop();return a},getAsMemberFunction:function(a,b,c,d){var e=this,x=e.targetCtx,f=13056;!1===
c?x=e.pubCtx:!0===c&&(x=e.privateCtx,d&&(f=13312));return function(){var c=arguments,d;e.callWithContext(f,function(a){d=b.apply(a,c)},x,{name:a});return d}},getAsPublicMethod:function(a,b){return this.getAsMemberFunction(a,b,!1,!0)},getAsPrivateMethod:function(a,b){return this.getAsMemberFunction(a,b,!0,!0)},getMethod:function(a){var b=this.trope.methodMap[a];return this.as(b.trope).getAsMemberFunction(a,b.func)},getPrivateMethod:function(a){var b=this.trope.privateMethodMap[a];return this.as(b.trope).getAsPrivateMethod(a,
b.func)},callAsConstructor:function(a){return this.callWithContext(12288,a,this.targetCtx)},getParentContextualFunction:function(){if(this.trope.inherits)return this.as(this.trope.inherits).getContextualFunction()},getSuperFunction:function(){return this.executionStack.peek().executionContext.getParentContextualFunction()},getContextualFunction:function(){var a=this.executionStack.peek(),b;if(a){b=a.type;a=a.data;if(12288===b)return this.getConstructor();if(12800===b)return a.superMethod;if(13056===
b)return this.getMethod(a.name);if(13312===b)return this.getPrivateMethod(a.name)}},getConstructor:function(){var a=this;return function(){var b=arguments;a.callAsConstructor(function(c){a.trope.constr.apply(c,b)})}}};e.prototype={getConstructor:function(){var a=this;return function(b){b.prototype=a.finalProto;b.trope=a;b.create=function(){return b.apply(null,arguments)};y(b,C,a.extend.bind(a));return b}(a.buildProxyConstructor())},buildProxyConstructor:function(){var a=this;return function(){var b=
arguments,c=f.create(a),d=c.getPublicContext(),e=c.getPrivateContext();a.useSuper&&d.hasOwnProperty&&!d.hasOwnProperty("super")&&Object.defineProperty(d,"super",{enumerable:!1,get:function(){var b;a.inherits&&(b=c.getSuperFunction());b&&(b.as=function(a){return c.as(a).getContextualFunction()});return b}});Object.keys(a.methodMap).forEach(function(b){var e=a.methodMap[b];u(d,b,c.as(e.trope).getAsMemberFunction(b,e.func))});a.privateMethodMap&&Object.keys(a.privateMethodMap).forEach(function(b){var d=
a.privateMethodMap[b];u(e,b,c.as(d.trope).getAsMemberFunction(b,d.func))});a.instanceContructor&&u(d,v,a.instanceContructor);a.autoInitializeConfigs.forEach(function(a){var d=a.trope;a.mode===B?c.as(d).getConstructor().apply(null,b):a.mode===z?c.as(d).getConstructor().apply(null,a.args):a.mode===A&&c.as(d).callAsConstructor(function(c){a.initFunc.apply(c,b)})});c.callAsConstructor(function(c){a.constr.apply(c,b)});return d}},getPrototype:function(){return this.inherits?d(this.proto,Object.create(this.inherits.finalProto)):
this.proto},getSuperConstructor:function(){return this.useSuper&&this.inherits?this.inherits.getConstructor(!0):null},forEachTropeInChain:function(a){this.inherits&&this.inherits.forEachTropeInChain(a);a(this)},forEachMethod:function(a){t(this.proto,function(b){w(b,a)})},createChildTrope:function(a){a=a||{};if(a.inherits){var b=this;(function(a){return a?a instanceof e?a:a.trope?a.trope:typeof a===l?new e({constructor:a,prototype:a.prototype,useSuper:!1}):new e({prototype:a,useSuper:!1}):null})(a.inherits).forEachTropeInChain(function(a){b=
new e(a.getDefinition({inherits:b}))});a.inherits=b}else a.inherits=this;return new e(a)},defineChild:function(a){return this.createChildTrope(a).getConstructor()},extend:function(){var a=arguments,a=(q[a.length]||q["?"]).apply(q,a);return this.defineChild(a)},getDefinition:function(a){return a?d(a,d(this.def,{})):d(this.def,{})},isInstance:function(a){var b=this,c=!1;p(a,function(a){a.constructor===b.constr&&(c=!0)});return c}};n.Trope=e;n.define=k;var q={0:function(){},1:function(a){var b=typeof a,
c;"object"===b?c=null!==a&&a.__TROPEDEF__?a:{prototype:a}:b===l?c=a.trope?a.trope.getDefinition():{constructor:a}:"string"===b&&(c={type:a});return c},2:function(a,b){var c=typeof a,e=typeof b,c="object"===c&&null!==a?a:c===l?a.trope?a.trope.getDefinition():{constructor:a}:"string"===c?{type:a}:{};"object"===e?c.prototype=b:e===l?b.trope?c=d(c,b.trope.getDefinition()):c.constructor=b:"string"===e&&(c.type=b);return c},3:function(a,b,c){var e=typeof a,f=typeof b,g=typeof c;a="object"===e&&null!==a?
a:e===l?a.trope?a.trope.getDefinition():{constructor:a}:"string"===e?{type:a}:{};"object"===f?a.prototype=b:f===l?b.trope?a=d(a,b.trope.getDefinition()):a.constructor=b:"string"===f&&(a.type=b);"object"===g?a.prototype=c:g===l?c.trope?a=d(a,c.trope.getDefinition()):a.constructor=c:"string"===g&&(a.type=c);return a},"?":function(){return this["3"].apply(this,arguments)}};n.Define=n;n.instanceOf=function(a,b){if(2!==arguments.length)throw Error("Trope.instanceOf only supports 2 arguments");var c,d;
if(typeof a===l&&"object"===typeof b)c=a,d=b;else if("object"===typeof a&&typeof b===l)d=a,c=b;else throw Error("Trope.instanceOf must have an OBJECT and FUNCTION as arguments");return c.trope?c.trope.isInstance(d):d instanceof c};y(n,C,n);return n}();r.exports=m},this);
